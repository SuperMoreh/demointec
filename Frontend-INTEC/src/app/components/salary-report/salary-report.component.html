<div class="content-container">
  <!-- Header de la página -->
  <div class="page-header">
    <div>
      <h1 class="page-title">Tabulador de Salarios</h1>
    </div>
  </div>

  <!-- Filtros y búsqueda -->
  <div class="filters-section">
    <div class="filters-row">
      <div class="filter-group">
        <label for="search">Buscar</label>
        <input type="text" id="search" class="filter-input" placeholder="Colaborador, puesto..."
          [value]="searchTerm" (input)="searchTerm = $any($event.target).value; applyFilter()" (keydown.enter)="$event.preventDefault()">
      </div>
      <div class="filter-group">
        <label for="incrementPercent">% Incremento Sugerido</label>
        <input type="number" id="incrementPercent" class="filter-input" placeholder="Ej. 5"
          min="0" max="100"
          [value]="incrementPercent ?? ''"
          (input)="incrementPercent = $any($event.target).value ? +$any($event.target).value : null; applyFilter()" (keydown.enter)="$event.preventDefault()">
      </div>
      <button class="btn-consult" (click)="load()" [disabled]="isLoading">
        <i class="bi bi-search"></i>
      </button>
      <button class="btn-tabulador ms-auto" (click)="openTabulador()">
        <i class="bi bi-table"></i> Tabulador General de Sueldos
      </button>
    </div>
  </div>

  <!-- Tabla -->
  <div class="table-container" *ngIf="hasConsulted && !isLoading">
    <div class="table-header">
      <div class="table-info">
        Mostrando {{ pagedRecords.length }} de {{ filteredRecords.length }} registros
      </div>
      <button class="btn-export" (click)="exportToExcel()" [disabled]="isLoading || filteredRecords.length === 0">
        <i class="bi bi-file-earmark-excel"></i> Exportar
      </button>
    </div>
    <div class="table-responsive">
      <table class="analysis-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Fecha de Ingreso</th>
            <th>Puesto</th>
            <th>Sueldo Semanal Actual</th>
            <th>Incremento Sugerido a Mercado Promedio</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let record of pagedRecords">
            <td class="td-id">{{ record.id_employee }}</td>
            <td class="td-project">{{ record.name_employee }}</td>
            <td class="td-num">{{ record.admission_date || '-' }}</td>
            <td class="td-num">{{ record.position || '-' }}</td>
            <td class="td-num">{{ (record.base_salary != null && +record.base_salary > 0) ? (+record.base_salary | currency:'MXN':'symbol':'1.2-2') : '-' }}</td>
            <td class="td-req">
              <ng-container *ngIf="calcIncrement(+record.base_salary) !== null; else sinIncremento">
                {{ calcIncrement(+record.base_salary) | currency:'MXN':'symbol':'1.2-2' }}
              </ng-container>
              <ng-template #sinIncremento>
                <span class="text-muted">-</span>
              </ng-template>
            </td>
          </tr>
          <tr *ngIf="pagedRecords.length === 0">
            <td colspan="6" class="text-center text-muted py-3">No hay registros disponibles</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="pagination-container" *ngIf="totalPages > 1">
      <div class="pagination">
        <button [disabled]="currentPage === 1" (click)="goToPage(currentPage - 1)">
          <i class="bi bi-chevron-left"></i>
        </button>
        <button *ngFor="let page of pages" [class.active]="page === currentPage" (click)="goToPage(page)">
          {{ page }}
        </button>
        <button [disabled]="currentPage === totalPages" (click)="goToPage(currentPage + 1)">
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <div class="table-container placeholder-container" *ngIf="hasConsulted && isLoading">
    <div class="table-placeholder">
      <i class="bi bi-arrow-repeat loading-icon"></i>
      Cargando reporte...
    </div>
  </div>

  <div class="consult-placeholder" *ngIf="!hasConsulted">
    <i class="bi bi-info-circle"></i>
    Consulte para ver la información del tabulador de salarios.
  </div>
</div>

<!-- Modal Tabulador General de Sueldos -->
<div class="modal fade" id="tabuladorGeneralModal" tabindex="-1" aria-labelledby="tabuladorGeneralModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header tabulador-modal-header">
        <h5 class="modal-title" id="tabuladorGeneralModalLabel">
          <i class="bi bi-table me-2"></i>Tabulador General de Sueldos
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body p-0">
        <app-salary-tabulador></app-salary-tabulador>
      </div>
    </div>
  </div>
</div>
