<div class="content-container">
  <!-- Header de la página -->
  <div class="page-header">
    <div>
      <h1 class="page-title">Prenomina</h1>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <form [formGroup]="filterForm" class="filters-row">
      <div class="filter-group">
        <label for="startDate">Fecha Inicial</label>
        <input type="date" id="startDate" class="filter-input" formControlName="startDate">
      </div>
      <div class="filter-group">
        <label for="endDate">Fecha Final</label>
        <input type="date" id="endDate" class="filter-input" formControlName="endDate">
      </div>
      <div class="filter-group">
        <label for="search">Buscar</label>
        <input type="text" id="search" class="filter-input" placeholder="Nombre del colaborador..." [(ngModel)]="searchTerm" [ngModelOptions]="{standalone: true}" (input)="applyFilters()">
      </div>
      <button type="button" class="btn-consult" (click)="consultPrenominas()" [disabled]="isLoading">
        <i class="bi bi-search"></i>
        Consultar
      </button>
      <button type="button" class="btn-filter" (click)="clearFilters()">
        <i class="bi bi-list-ul"></i>
      </button>
    </form>
  </div>

  <!-- Tabla de prenomina agrupada por obra -->
  <div class="table-container" *ngIf="hasConsulted && !isLoading && filteredPrenominas.length > 0">
    <div class="table-header">
      <div class="table-info">
        Mostrando {{ prenominas.length }} de {{ filteredPrenominas.length }} registros
        <span *ngIf="hasActiveFilters()" class="text-muted">(filtrados)</span>
      </div>
      <div class="table-actions">
        <button class="btn-filter1" (click)="exportToExcel()">
          <i class="bi bi-download"></i>
          Exportar Excel
        </button>
      </div>
    </div>
    <div class="table-responsive">
      <table class="users-table">
        <thead>
          <tr>
            <th>Obra / Colaborador</th>
            <th>Estatus</th>
            <th *ngIf="isMultiDay">Fecha</th>
            <th>Entrada</th>
            <th>Salida</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let group of groupedPrenominas">
            <tr class="project-row">
              <td [attr.colspan]="isMultiDay ? 5 : 4">
                <i class="bi bi-building"></i>
                <strong>{{ group.project }}</strong>
                <span class="employee-count">({{ group.employees.length }})</span>
              </td>
            </tr>
            <tr *ngFor="let item of group.employees" class="employee-row">
              <td class="employee-name">{{ item.name_employee }}</td>
              <td>
                <span class="status-badge" [ngClass]="item.status === 'En Obra' ? 'status-active' : 'status-inactive'">
                  {{ item.status }}
                </span>
              </td>
              <td *ngIf="isMultiDay">{{ item.date }}</td>
              <td>{{ item.entry_time ? item.entry_time : '---' }}</td>
              <td>{{ item.exit_time ? item.exit_time : '---' }}</td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
    <!-- Paginación -->
    <div class="pagination-container" *ngIf="totalPages > 1">
      <div class="pagination">
        <button [disabled]="currentPage === 1" (click)="setPage(currentPage - 1)">
          <i class="bi bi-chevron-left"></i>
        </button>
        <button *ngFor="let page of pages" [class.active]="page === currentPage" (click)="setPage(page)">
          {{ page }}
        </button>
        <button [disabled]="currentPage === totalPages" (click)="setPage(currentPage + 1)">
          <i class="bi bi-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <div class="table-container placeholder-container" *ngIf="hasConsulted && !isLoading && filteredPrenominas.length === 0">
    <div class="table-placeholder">
      <i class="bi bi-inbox"></i>
      No se encontraron registros de prenomina con los filtros aplicados.
    </div>
  </div>
  <div class="table-container placeholder-container" *ngIf="hasConsulted && isLoading">
    <div class="table-placeholder">
      <i class="bi bi-arrow-repeat loading-icon"></i>
      Cargando prenomina...
    </div>
  </div>
  <div class="consult-placeholder" *ngIf="!hasConsulted">
    <i class="bi bi-info-circle"></i>
    Seleccione un rango de fechas y presione Consultar para ver la prenomina.
  </div>
</div>
