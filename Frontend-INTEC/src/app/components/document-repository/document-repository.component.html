<div class="content-container">
    <div class="page-header">
        <h1 class="page-title">Repositorio Documental</h1>
    </div>

    <!-- Panel 1: Búsqueda -->
    <div class="filters-section">
        <h5 class="mb-3" style="font-weight: 400; color: #555;">Búsqueda de Colaborador</h5>
        <form [formGroup]="searchForm">
            <div class="position-relative">
                <div class="input-group">
                    <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control filter-input" placeholder="Escribe el nombre del empleado..."
                        formControlName="searchTerm" (keydown)="onKeydown($event)">
                </div>

                <!-- Lista de sugerencias -->
                <ul class="list-group position-absolute w-100 mt-1 shadow" style="z-index: 1000;"
                    *ngIf="filteredEmployees.length > 0">
                    <li class="list-group-item list-group-item-action cursor-pointer border-bottom"
                        *ngFor="let emp of filteredEmployees; let i = index"
                        [class.active-search-item]="i === selectedIndex" (click)="selectEmployee(emp)">
                        <strong>{{ emp.name_employee }}</strong> <small class="text-muted ms-2">({{ emp.role }})</small>
                    </li>
                </ul>
            </div>
        </form>

        <!-- Datos básicos del empleado seleccionado -->
        <div *ngIf="selectedEmployee"
            class="mt-4 p-3 bg-white rounded border d-flex justify-content-between align-items-center">
            <div>
                <h5 class="mb-1 text-primary">{{ selectedEmployee.name_employee }}</h5>
                <div class="text-muted small">
                    <span class="me-3"><i class="bi bi-briefcase"></i> {{ selectedEmployee.position || 'Sin puesto'
                        }}</span>
                    <span class="me-3"><i class="bi bi-envelope"></i> {{ selectedEmployee.email }}</span>
                    <span><i class="bi bi-telephone"></i> {{ selectedEmployee.phone }}</span>
                </div>
            </div>
            <div>
                <span class="status-badge" [ngClass]="selectedEmployee.status ? 'status-active' : 'status-inactive'">
                    {{ selectedEmployee.status ? 'Activo' : 'Inactivo' }}
                </span>
            </div>
        </div>
    </div>

    <!-- Panel 2: Lista de Documentos -->
    <div class="card" *ngIf="selectedEmployee">
        <div class="card-header">
            <h5><i class="bi bi-folder2-open text-primary"></i> Documentos del Colaborador</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th style="width: 50%;">Nombre del Documento</th>
                            <th style="width: 20%; text-align: center;">Estatus</th>
                            <th style="width: 30%; text-align: center;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let doc of documentsList">
                            <td>{{ doc.name }}</td>
                            <td class="text-center">
                                <i class="bi bi-check-circle-fill status-icon status-ok" *ngIf="doc.uploaded"
                                    title="Subido"></i>
                                <i class="bi bi-x-circle-fill status-icon status-missing" *ngIf="!doc.uploaded"
                                    title="Pendiente"></i>
                            </td>
                            <td class="text-center">
                                <button class="btn-upload" (click)="initiateUpload(doc.name)">
                                    <i class="bi bi-upload"></i> Subir
                                </button>
                                <a *ngIf="doc.uploaded && doc.path" [href]="doc.path" target="_blank" class="btn-view">
                                    <i class="bi bi-eye"></i> Ver
                                </a>
                                <button *ngIf="canDelete && doc.uploaded" class="btn-delete ms-2"
                                    (click)="deleteDocument(doc)" title="Eliminar documento">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="3" class="pt-3">
                                <div class="d-flex align-items-center">
                                    <input type="text" class="form-control me-2" style="max-width: 300px;"
                                        placeholder="Nombre del nuevo documento..." [(ngModel)]="customDocName"
                                        (keydown.enter)="addCustomDocument()">
                                    <input type="file" class="form-control me-2" style="max-width: 300px;"
                                        (change)="onCustomFileSelected($event)" #customFileInput>
                                    <button class="btn-add-doc" (click)="addCustomDocument()"
                                        [disabled]="!customDocName.trim()">
                                        <i class="bi bi-plus-circle"></i> Agregar Documento
                                    </button>
                                </div>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- Hidden File Input -->
    <input type="file" id="docFileInput" style="display: none;" (change)="onFileSelected($event)"
        accept=".pdf, .jpg, .jpeg, .png">
</div>